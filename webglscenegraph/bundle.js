(()=>{"use strict";let n=Float32Array;function t(t,o,e){e=e||new n(16);var r=o[0],i=o[1],a=o[2],c=o[3],u=o[4],s=o[5],l=o[6],f=o[7],d=o[8],h=o[9],m=o[10],p=o[11],v=o[12],M=o[13],E=o[14],w=o[15],x=t[0],g=t[1],_=t[2],A=t[3],y=t[4],C=t[5],b=t[6],I=t[7],T=t[8],L=t[9],R=t[10],P=t[11],O=t[12],S=t[13],U=t[14],F=t[15];return e[0]=r*x+i*y+a*T+c*O,e[1]=r*g+i*C+a*L+c*S,e[2]=r*_+i*b+a*R+c*U,e[3]=r*A+i*I+a*P+c*F,e[4]=u*x+s*y+l*T+f*O,e[5]=u*g+s*C+l*L+f*S,e[6]=u*_+s*b+l*R+f*U,e[7]=u*A+s*I+l*P+f*F,e[8]=d*x+h*y+m*T+p*O,e[9]=d*g+h*C+m*L+p*S,e[10]=d*_+h*b+m*R+p*U,e[11]=d*A+h*I+m*P+p*F,e[12]=v*x+M*y+E*T+w*O,e[13]=v*g+M*C+E*L+w*S,e[14]=v*_+M*b+E*R+w*U,e[15]=v*A+M*I+E*P+w*F,e}function o(t){return(t=t||new n(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function e(t,o,e,r){return(r=r||new n(16))[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t,r[13]=o,r[14]=e,r[15]=1,r}function r(t,o){o=o||new n(16);var e=Math.cos(t),r=Math.sin(t);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e,o[6]=r,o[7]=0,o[8]=0,o[9]=-r,o[10]=e,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function i(t,o){o=o||new n(16);var e=Math.cos(t),r=Math.sin(t);return o[0]=e,o[1]=0,o[2]=-r,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=r,o[9]=0,o[10]=e,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function a(t,o){o=o||new n(16);var e=Math.cos(t),r=Math.sin(t);return o[0]=e,o[1]=r,o[2]=0,o[3]=0,o[4]=-r,o[5]=e,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function c(t,o,e){e=e||new n(16);var r=t[0],i=t[1],a=t[2],c=Math.sqrt(r*r+i*i+a*a),u=(r/=c)*r,s=(i/=c)*i,l=(a/=c)*a,f=Math.cos(o),d=Math.sin(o),h=1-f;return e[0]=u+(1-u)*f,e[1]=r*i*h+a*d,e[2]=r*a*h-i*d,e[3]=0,e[4]=r*i*h-a*d,e[5]=s+(1-s)*f,e[6]=i*a*h+r*d,e[7]=0,e[8]=r*a*h+i*d,e[9]=i*a*h-r*d,e[10]=l+(1-l)*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u(t,o,e,r){return(r=r||new n(16))[0]=t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function s(t,o,e){e=e||new n(3);var r=o[0],i=o[1],a=o[2],c=r*t[3]+i*t[7]+a*t[11]+t[15];return e[0]=(r*t[0]+i*t[4]+a*t[8]+t[12])/c,e[1]=(r*t[1]+i*t[5]+a*t[9]+t[13])/c,e[2]=(r*t[2]+i*t[6]+a*t[10]+t[14])/c,e}function l(t,o,e){e=e||new n(3);var r=o[0],i=o[1],a=o[2];return e[0]=r*t[0]+i*t[4]+a*t[8],e[1]=r*t[1]+i*t[5]+a*t[9],e[2]=r*t[2]+i*t[6]+a*t[10],e}const f=window;function d(n){f.console&&(f.console.error?f.console.error(n):f.console.log&&f.console.log(n))}function h(n,t,o,e){const r=e||d,i=n.createShader(o);return n.shaderSource(i,t),n.compileShader(i),n.getShaderParameter(i,n.COMPILE_STATUS)?i:(r("*** Error compiling shader '"+i+"':"+n.getShaderInfoLog(i)+"\n"+t.split("\n").map(((n,t)=>`${t+1}: ${n}`)).join("\n")),n.deleteShader(i),null)}const m=["VERTEX_SHADER","FRAGMENT_SHADER"];function p(n,t){return t===n.SAMPLER_2D?n.TEXTURE_2D:t===n.SAMPLER_CUBE?n.TEXTURE_CUBE_MAP:void 0}function v(n,t,o){(function(n,t){n=n.attribSetters||n,Object.keys(t).forEach((function(o){const e=n[o];e&&e(t[o])}))})(t,o.attribs),o.indices&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.indices)}function M(n,t,o){return function(n,t){let o=0;return n.push=function(){for(let t=0;t<arguments.length;++t){const e=arguments[t];if(e instanceof Array||e.buffer&&e.buffer instanceof ArrayBuffer)for(let t=0;t<e.length;++t)n[o++]=e[t];else n[o++]=e}},n.reset=function(n){o=n||0},n.numComponents=t,Object.defineProperty(n,"numElements",{get:function(){return this.length/this.numComponents|0}}),n}(new(o||Float32Array)(n*t),n)}function E(n,t,o,e){o=o||n.ARRAY_BUFFER;const r=n.createBuffer();return n.bindBuffer(o,r),n.bufferData(o,t,e||n.STATIC_DRAW),r}function w(n){return"indices"!==n}function x(n,t){if(t instanceof Int8Array)return n.BYTE;if(t instanceof Uint8Array)return n.UNSIGNED_BYTE;if(t instanceof Int16Array)return n.SHORT;if(t instanceof Uint16Array)return n.UNSIGNED_SHORT;if(t instanceof Int32Array)return n.INT;if(t instanceof Uint32Array)return n.UNSIGNED_INT;if(t instanceof Float32Array)return n.FLOAT;throw"unsupported typed array type"}function g(n){return n.buffer&&n.buffer instanceof ArrayBuffer}function _(n,t){if(g(n))return n;if(n.data&&g(n.data))return n.data;Array.isArray(n)&&(n={data:n}),n.numComponents||(n.numComponents=I(t,n.length));let o=n.type;o||"indices"===t&&(o=Uint16Array);const e=M(n.numComponents,n.data.length/n.numComponents|0,o);return e.push(n.data),e}function A(n,t,o){const e=o||function(n){const t={};return Object.keys(n).filter(w).forEach((function(n){t["a_"+n]=n})),t}(t),r={};return Object.keys(e).forEach((function(o){const i=e[o],a=t[i];if(a.value)r[o]={value:a.value};else{const t=_(a,i);r[o]={buffer:E(n,t),numComponents:a.numComponents||t.numComponents||I(i),type:x(n,t),normalize:(c=t,c instanceof Int8Array||c instanceof Uint8Array)}}var c})),r}function y(n){return n.length?n:n.data}const C=/coord|texture/i,b=/color|colour/i;function I(n,t){let o;if(o=C.test(n)?2:b.test(n)?4:3,t%o>0)throw new Error(`Can not guess numComponents for attribute '${n}'. Tried ${o} but ${t} values is not evenly divisible by ${o}. You should specify it.`);return o}const T=["position","positions","a_position"];function L(n,t,o){const e={attribs:A(n,t,o)};let r=t.indices;return r?(r=_(r,"indices"),e.indices=E(n,r,n.ELEMENT_ARRAY_BUFFER),e.numElements=r.length):e.numElements=function(n){let t;for(const o of T)if(o in n){t=o;break}t=t||Object.keys(n)[0];const o=n[t],e=y(o).length,r=function(n,t){return n.numComponents||n.size||I(t,y(n).length)}(o,t),i=e/r;if(e%r>0)throw new Error(`numComponents ${r} not correct for length ${e}`);return i}(t),e}var R;function P(n,t,o,e,r){n.addEventListener("mousedown",(function(t){if(!h){h=!0,document.addEventListener("mousemove",p,!1),document.addEventListener("mouseup",v,!1);var o=n.getBoundingClientRect();a=t.clientX-o.left,c=t.clientY-o.top}}),!1),n.addEventListener("touchstart",(function(t){if(1==t.touches.length){t.preventDefault();var o=n.getBoundingClientRect();a=t.touches[0].clientX-o.left,c=t.touches[0].clientY-o.top,n.addEventListener("touchmove",M,!1),n.addEventListener("touchend",E,!1),n.addEventListener("touchcancel",w,!1),m=!0}else w()}),!1);var i,a,c,u=void 0===r?0:r,s=void 0===e?0:e,l=85,f=90/n.height,d=180/n.width;this.getXLimit=function(){return l},this.setXLimit=function(n){l=Math.min(85,Math.max(0,n))},this.getRotationCenter=function(){return void 0===i?[0,0,0]:i},this.setRotationCenter=function(n){i=n},this.setAngles=function(n,o){u=Math.max(-l,Math.min(l,o)),s=n,t&&t()},this.getAngles=function(){return[u,s]},this.setViewDistance=function(n){o=n},this.getViewDistance=function(){return void 0===o?0:o},this.getViewMatrix=function(){var n=Math.cos(u/180*Math.PI),t=Math.sin(u/180*Math.PI),e=Math.cos(s/180*Math.PI),r=Math.sin(s/180*Math.PI),a=[e,t*r,-n*r,0,0,n,t,0,r,-t*e,n*e,0,0,0,0,1];if(void 0!==i){var c=i[0]-a[0]*i[0]-a[4]*i[1]-a[8]*i[2],l=i[1]-a[1]*i[0]-a[5]*i[1]-a[9]*i[2],f=i[2]-a[2]*i[0]-a[6]*i[1]-a[10]*i[2];a[12]=c,a[13]=l,a[14]=f}return void 0!==o&&(a[14]-=o),a};var h=!1,m=!1;function p(o){if(h){var e=n.getBoundingClientRect(),r=o.clientX-e.left,i=o.clientY-e.top,m=u+f*(i-c),p=s+d*(r-a);m=Math.max(-l,Math.min(l,m)),a=r,c=i,m==u&&p==s||(u=m,s=p,t&&t())}}function v(n){h&&(h=!1,document.removeEventListener("mousemove",p,!1),document.removeEventListener("mouseup",v,!1))}function M(o){if(1==o.touches.length&&m){o.preventDefault();var e=n.getBoundingClientRect(),r=o.touches[0].clientX-e.left,i=o.touches[0].clientY-e.top,h=u+f*(i-c),p=s+d*(r-a);h=Math.max(-l,Math.min(l,h)),a=r,c=i,h==u&&p==s||(u=h,s=p,t&&t())}else w()}function E(n){w()}function w(){m&&(m=!1,n.removeEventListener("touchmove",M,!1),n.removeEventListener("touchend",E,!1),n.removeEventListener("touchcancel",w,!1))}}!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(R=HTMLCanvasElement.prototype.getContext,function(){let n=arguments;return"webgl"===n[0]&&(n=[].slice.call(arguments),n[0]="experimental-webgl"),R.apply(this,n)}));const O=Node=function(n,t=0){this.name=n,this.children=[],this.parents=[],this.localMatrix=o(),this.worldMatrix=o(),this.parentCount=0,this.type=t};function S(n){return"indices"!==n}function U(n,t,o){const e=n.length,r=new Float32Array(3);for(let i=0;i<e;i+=3)o(t,[n[i],n[i+1],n[i+2]],r),n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2]}function F(n,t,o){o=o||new Float32Array(3);const e=t[0],r=t[1],i=t[2];return o[0]=e*n[0]+r*n[1]+i*n[2],o[1]=e*n[4]+r*n[5]+i*n[6],o[2]=e*n[8]+r*n[9]+i*n[10],o}function B(t,o){return Object.keys(t).forEach((function(e){const r=t[e];e.indexOf("pos")>=0?function(n,t){U(n,t,s)}(r,o):e.indexOf("tan")>=0||e.indexOf("binorm")>=0?function(n,t){U(n,t,l)}(r,o):e.indexOf("norm")>=0&&function(t,o){U(t,function(t,o){o=o||new n(16);var e=t[0],r=t[1],i=t[2],a=t[3],c=t[4],u=t[5],s=t[6],l=t[7],f=t[8],d=t[9],h=t[10],m=t[11],p=t[12],v=t[13],M=t[14],E=t[15],w=h*E,x=M*m,g=s*E,_=M*l,A=s*m,y=h*l,C=i*E,b=M*a,I=i*m,T=h*a,L=i*l,R=s*a,P=f*v,O=p*d,S=c*v,U=p*u,F=c*d,B=f*u,N=e*v,V=p*r,k=e*d,D=f*r,z=e*u,Y=c*r,j=w*u+_*d+A*v-(x*u+g*d+y*v),H=x*r+C*d+T*v-(w*r+b*d+I*v),X=g*r+b*u+L*v-(_*r+C*u+R*v),W=y*r+I*u+R*d-(A*r+T*u+L*d),$=1/(e*j+c*H+f*X+p*W);return o[0]=$*j,o[1]=$*H,o[2]=$*X,o[3]=$*W,o[4]=$*(x*c+g*f+y*p-(w*c+_*f+A*p)),o[5]=$*(w*e+b*f+I*p-(x*e+C*f+T*p)),o[6]=$*(_*e+C*c+R*p-(g*e+b*c+L*p)),o[7]=$*(A*e+T*c+L*f-(y*e+I*c+R*f)),o[8]=$*(P*l+U*m+F*E-(O*l+S*m+B*E)),o[9]=$*(O*a+N*m+D*E-(P*a+V*m+k*E)),o[10]=$*(S*a+V*l+z*E-(U*a+N*l+Y*E)),o[11]=$*(B*a+k*l+Y*m-(F*a+D*l+z*m)),o[12]=$*(S*h+B*M+O*s-(F*M+P*s+U*h)),o[13]=$*(k*M+P*i+V*h-(N*h+D*M+O*i)),o[14]=$*(N*s+Y*M+U*i-(z*M+S*i+V*s)),o[15]=$*(z*h+F*i+D*s-(k*s+Y*h+B*i)),o}(o),F)}(r,o)})),t}function N(n){return function(t){return function(n,t){const o={};return Object.keys(t).forEach((function(e){const r="indices"===e?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER,i=_(t[e],name);o[e]=E(n,i,r)})),t.indices?o.numElements=t.indices.length:t.position&&(o.numElements=t.position.length/3),o}(t,n.apply(this,Array.prototype.slice.call(arguments,1)))}}function V(n){return function(t){return L(t,n.apply(null,Array.prototype.slice.call(arguments,1)))}}function k(n,t,e,r,i){n=n||1,t=t||1,e=e||1,r=r||1,i=i||o();const a=(e+1)*(r+1),c=M(3,a),u=M(3,a),s=M(2,a);for(let o=0;o<=r;o++)for(let i=0;i<=e;i++){const a=i/e,l=o/r;c.push(n*a-.5*n,0,t*l-.5*t),u.push(0,1,0),s.push(a,l)}const l=e+1,f=M(3,e*r*2,Uint16Array);for(let n=0;n<r;n++)for(let t=0;t<e;t++)f.push((n+0)*l+t,(n+1)*l+t,(n+0)*l+t+1),f.push((n+1)*l+t,(n+1)*l+t+1,(n+0)*l+t+1);return B({position:c,normal:u,texcoord:s,indices:f},i)}function D(n,t,o){return n=n||2,{position:{numComponents:2,data:[(t=t||0)+-1*(n*=.5),(o=o||0)+-1*n,t+1*n,o+-1*n,t+-1*n,o+1*n,t+1*n,o+1*n]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function z(n,t,o,e,r,i,a){if(t<=0||o<=0)throw Error("subdivisionAxis and subdivisionHeight must be > 0");e=e||0,i=i||0;const c=(r=r||Math.PI)-e,u=(a=a||2*Math.PI)-i,s=(t+1)*(o+1),l=M(3,s),f=M(3,s),d=M(2,s);for(let r=0;r<=o;r++)for(let a=0;a<=t;a++){const s=a/t,h=r/o,m=u*s+i,p=c*h+e,v=Math.sin(m),M=Math.cos(m),E=Math.sin(p),w=M*E,x=Math.cos(p),g=v*E;l.push(n*w,n*x,n*g),f.push(w,x,g),d.push(1-s,h)}const h=t+1,m=M(3,t*o*2,Uint16Array);for(let n=0;n<t;n++)for(let t=0;t<o;t++)m.push((t+0)*h+n,(t+0)*h+n+1,(t+1)*h+n),m.push((t+1)*h+n,(t+0)*h+n+1,(t+1)*h+n+1);return{position:l,normal:f,texcoord:d,indices:m}}Node.prototype.addChild=function(n){this.children.push(n)},Node.prototype.copy=function(n){const t=new Node(n.name+"-copy");return t.localMatrix=n.localMatrix,t.worldMatrix=n.worldMatrix,n.drawInfo&&(t.drawInfo={},t.drawInfo.bufferInfo=this.drawInfo.bufferInfo,t.drawInfo.programInfo=this.drawInfo.programInfo,t.drawInfo.uniforms=n.drawInfo.uniforms),t},Node.prototype.updateWorldMatrix=function(o){var e,r;0===this.type&&(o?t(o,this.localMatrix,this.worldMatrix):(e=this.localMatrix,(r=(r=this.worldMatrix)||new n(16))[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]));var i=this.worldMatrix;this.children.forEach((function(n){n.updateWorldMatrix(i)}))};const Y=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function j(n){const t=n/2,o=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],e=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],r=[[1,0],[0,0],[0,1],[1,1]],i=M(3,24),a=M(3,24),c=M(2,24),u=M(3,12,Uint16Array);for(let n=0;n<6;++n){const t=Y[n];for(let u=0;u<4;++u){const s=o[t[u]],l=e[n],f=r[u];i.push(s),a.push(l),c.push(f)}const s=4*n;u.push(s+0,s+1,s+2),u.push(s+0,s+2,s+3)}return{position:i,normal:a,texcoord:c,indices:u}}function H(n,t,o,e,r,i,a){if(e<3)throw Error("radialSubdivisions must be 3 or greater");if(r<1)throw Error("verticalSubdivisions must be 1 or greater");const c=void 0===i||i,u=void 0===a||a,s=(c?2:0)+(u?2:0),l=(e+1)*(r+1+s),f=M(3,l),d=M(3,l),h=M(2,l),m=M(3,e*(r+s)*2,Uint16Array),p=e+1,v=Math.atan2(n-t,o),E=Math.cos(v),w=Math.sin(v),x=r+(u?2:0);for(let i=c?-2:0;i<=x;++i){let a,c=i/r,u=o*c;i<0?(u=0,c=1,a=n):i>r?(u=o,c=1,a=t):a=n+i/r*(t-n),-2!==i&&i!==r+2||(a=0,c=0),u-=o/2;for(let n=0;n<p;++n){const t=Math.sin(n*Math.PI*2/e),o=Math.cos(n*Math.PI*2/e);f.push(t*a,u,o*a),d.push(i<0||i>r?0:t*E,i<0?-1:i>r?1:w,i<0||i>r?0:o*E),h.push(n/e,1-c)}}for(let n=0;n<r+s;++n)for(let t=0;t<e;++t)m.push(p*(n+0)+0+t,p*(n+0)+1+t,p*(n+1)+1+t),m.push(p*(n+0)+0+t,p*(n+1)+1+t,p*(n+1)+0+t);return{position:f,normal:d,texcoord:h,indices:m}}function X(n,t){t=t||[];const o=[];for(let e=0;e<n.length;e+=4){const r=n[e],i=n.slice(e+1,e+4);i.push.apply(i,t);for(let n=0;n<r;++n)o.push.apply(o,i)}return o}function W(){const n=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=X([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),o=X([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),e=n.length/3,r={position:M(3,e),texcoord:M(2,e),normal:M(3,e),color:M(4,e,Uint8Array),indices:M(3,e/3,Uint16Array)};r.position.push(n),r.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),r.normal.push(t),r.color.push(o);for(let n=0;n<e;++n)r.indices.push(n);return r}function $(n){return function(t,...o){let e=n(...o);return e=function(n){const t=n.indices,o={},e=t.length;return Object.keys(n).filter(S).forEach((function(r){const i=n[r],a=i.numComponents,c=M(a,e,i.constructor);for(let n=0;n<e;++n){const o=t[n]*a;for(let n=0;n<a;++n)c.push(i[o+n])}o[r]=c})),o}(e),e=function(n,t){t=t||{};const o=n.position.numElements,e=M(4,o,Uint8Array),r=t.rand||function(n,t){return t<3?256*Math.random()|0:255};if(n.color=e,n.indices)for(let n=0;n<o;++n)e.push(r(n,0),r(n,1),r(n,2),r(n,3));else{const n=t.vertsPerColor||3,i=o/n;for(let t=0;t<i;++t){const o=[r(t,0),r(t,1),r(t,2),r(t,3)];for(let t=0;t<n;++t)e.push(o)}}return n}(e,{vertsPerColor:6,rand:function(n,t){return t<3?60*Math.random():255}}),L(t,e)}}V(W),N(W),$(W),V(j),N(j),$(j),V(k),N(k),$(k),V(D),N(D),$(D),V(z),N(z);const q=$(z),G=(V(H),N(H),$(H),document.querySelector("#canvas")),K=G.getContext("webgl2");let J=0;const Q=[],Z=[];Z.push("#version 300 es\nin vec4 a_position;\nin vec4 a_color;\nin vec3 a_normal;\nout vec3 v_normal;\nout vec3 v_eyeCoords;\nout vec3 v_pos;\n\nout vec4 v_color;\nuniform mat4 u_P, u_VW; //projection, view-world\n\nvoid main() {\n  // Multiply the position by the matrix.\n\n  vec4  eyeCoords = u_VW * a_position;\n\n  gl_Position = u_P * eyeCoords;\n\n  // Pass the color to the fragment shader.\n  v_color = a_color;\n  v_normal = normalize(a_normal); //in case it is not??\n  v_eyeCoords = eyeCoords.xyz; // / eyeCoords.w;\n  v_pos = a_position.xyz;\n}\n"),Z.push("#version 300 es\nprecision mediump float;\n    \n// Passed in from the vertex shader.\nin vec4 v_color;\nin vec3 v_normal;\nin vec3 v_eyeCoords;\nin vec3 v_pos;\n\nuniform vec4 u_colorMult;\nuniform vec4 u_colorOffset;\nuniform mat3 u_N;  //matrix for transforming normals\n\nout vec4 finalColor;\n\nvoid main() {\n\n  vec3 newNormal = normalize( u_N * v_normal );\n\n  //need to send in cameraPos as uniform vec3 to make it general\n  float cameraPos = 350.;\n  //this creates a point light source at 0,0,0\n  vec3 L = normalize( - (v_eyeCoords + vec3(0.,0., cameraPos) )  );\n  \n  float ii = max(0., dot(L,newNormal) );\n  finalColor = v_color * u_colorMult + u_colorOffset;\n  finalColor *= .6;\n\n  finalColor *= (1. + ii*3.);\n\n  finalColor.xyz *= finalColor.xyz;  //moew dramatic lighting\n}\n");const nn=function(n,t,o,e,r){const i=function(n,t,o,e,r){const i=[];for(let o=0;o<t.length;++o)i.push(h(n,t[o],n[m[o]],r));return function(n,t,o,e,r){const i=r||d,a=n.createProgram();return t.forEach((function(t){n.attachShader(a,t)})),o&&o.forEach((function(t,o){n.bindAttribLocation(a,e?e[o]:o,t)})),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)?a:(i("Error in program linking:"+n.getProgramInfoLog(a)),n.deleteProgram(a),null)}(n,i,undefined,undefined,r)}(n,t=t.map((function(n){const t=document.getElementById(n);return t?t.text:n})),0,0,void 0);if(!i)return null;const a=function(n,t){let o=0;function e(t,e){const r=n.getUniformLocation(t,e.name),i=e.type,a=e.size>1&&"[0]"===e.name.substr(-3);if(i===n.FLOAT&&a)return function(t){n.uniform1fv(r,t)};if(i===n.FLOAT)return function(t){n.uniform1f(r,t)};if(i===n.FLOAT_VEC2)return function(t){n.uniform2fv(r,t)};if(i===n.FLOAT_VEC3)return function(t){n.uniform3fv(r,t)};if(i===n.FLOAT_VEC4)return function(t){n.uniform4fv(r,t)};if(i===n.INT&&a)return function(t){n.uniform1iv(r,t)};if(i===n.INT)return function(t){n.uniform1i(r,t)};if(i===n.INT_VEC2)return function(t){n.uniform2iv(r,t)};if(i===n.INT_VEC3)return function(t){n.uniform3iv(r,t)};if(i===n.INT_VEC4)return function(t){n.uniform4iv(r,t)};if(i===n.BOOL)return function(t){n.uniform1iv(r,t)};if(i===n.BOOL_VEC2)return function(t){n.uniform2iv(r,t)};if(i===n.BOOL_VEC3)return function(t){n.uniform3iv(r,t)};if(i===n.BOOL_VEC4)return function(t){n.uniform4iv(r,t)};if(i===n.FLOAT_MAT2)return function(t){n.uniformMatrix2fv(r,!1,t)};if(i===n.FLOAT_MAT3)return function(t){n.uniformMatrix3fv(r,!1,t)};if(i===n.FLOAT_MAT4)return function(t){n.uniformMatrix4fv(r,!1,t)};if((i===n.SAMPLER_2D||i===n.SAMPLER_CUBE)&&a){const t=[];for(let n=0;n<info.size;++n)t.push(o++);return function(t,o){return function(e){n.uniform1iv(r,o),e.forEach((function(e,r){n.activeTexture(n.TEXTURE0+o[r]),n.bindTexture(t,e)}))}}(p(n,i),t)}if(i===n.SAMPLER_2D||i===n.SAMPLER_CUBE)return c=p(n,i),u=o++,function(t){n.uniform1i(r,u),n.activeTexture(n.TEXTURE0+u),n.bindTexture(c,t)};var c,u;throw"unknown type: 0x"+i.toString(16)}const r={},i=n.getProgramParameter(t,n.ACTIVE_UNIFORMS);for(let o=0;o<i;++o){const i=n.getActiveUniform(t,o);if(!i)break;let a=i.name;"[0]"===a.substr(-3)&&(a=a.substr(0,a.length-3));const c=e(t,i);r[a]=c}return r}(n,i),c=function(n,t){const o={};function e(t){return function(o){if(o.value)switch(n.disableVertexAttribArray(t),o.value.length){case 4:n.vertexAttrib4fv(t,o.value);break;case 3:n.vertexAttrib3fv(t,o.value);break;case 2:n.vertexAttrib2fv(t,o.value);break;case 1:n.vertexAttrib1fv(t,o.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else n.bindBuffer(n.ARRAY_BUFFER,o.buffer),n.enableVertexAttribArray(t),n.vertexAttribPointer(t,o.numComponents||o.size,o.type||n.FLOAT,o.normalize||!1,o.stride||0,o.offset||0)}}const r=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;++i){const r=n.getActiveAttrib(t,i);if(!r)break;const a=n.getAttribLocation(t,r.name);o[r.name]=e(a)}return o}(n,i);return{program:i,uniformSetters:a,attribSetters:c}}(K,Z),tn=q(K,7,35,21),on=new O("solar system"),en=new O("sun");en.localMatrix=u(6,6,6),en.drawInfo={uniforms:{u_colorOffset:[1.5,1.5,.7,1],u_colorMult:[1,1,0,1]}};const rn=new O("earth orbit");rn.localMatrix=e(110,0,0);const an=new O("earth");an.localMatrix=u(3,3,3),an.drawInfo={uniforms:{u_colorOffset:[.1,.4,.7,1],u_colorMult:[.8,.6,.3,1]}};const cn=function(t,o){o=o||new n(3);var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return e>1e-5&&(o[0]=t[0]/e,o[1]=t[1]/e,o[2]=t[2]/e),o}([1,.3,0]),un=s(a(Math.PI/2),cn),sn=new O("moon orbit"),ln=(fn=cn,30,(dn=dn||new n(3))[0]=30*fn[0],dn[1]=30*fn[1],dn[2]=30*fn[2],dn);var fn,dn;sn.localMatrix=e(ln[0],ln[1],ln[2]);const hn=new O("moon");hn.localMatrix=u(1.2,1.2,1.2),hn.drawInfo={uniforms:{u_colorOffset:[.4,.4,.4,1],u_colorMult:[.3,.3,.3,1]}};const mn=new O("moon2 orbit");mn.localMatrix=e(40,0,0),t(i(Math.PI),mn.localMatrix,mn.localMatrix);const pn=new O("moon2");pn.localMatrix=u(.5,.6,.5),pn.drawInfo={uniforms:{u_colorOffset:[.5,.3,.2,1],u_colorMult:[.3,.3,.3,1]}};const vn=new O("binary planetoids");vn.localMatrix=e(0,105,0),t(vn.localMatrix,r(Math.PI/2),vn.localMatrix);const Mn=new O("b1 orbit"),En=new O("b2 orbit");Mn.localMatrix=e(20,0,0),En.localMatrix=e(-20,0,0);const wn=new O("b1"),xn=new O("b2");wn.localMatrix=u(1.5,1.5,2.5),xn.localMatrix=u(1.5,1.5,2.5),wn.drawInfo={uniforms:{u_colorOffset:[.3,.2,0,1],u_colorMult:[.4,.6,0,1]}},xn.drawInfo={uniforms:{u_colorOffset:[0,.2,.3,1],u_colorMult:[0,.6,.4,1]}};const gn=new O("sphere",1);gn.drawInfo={programInfo:nn,bufferInfo:tn},on.addChild(en),on.addChild(rn),on.addChild(vn),rn.addChild(an),rn.addChild(sn),sn.addChild(hn),rn.addChild(mn),mn.addChild(pn),vn.addChild(Mn),vn.addChild(En),Mn.addChild(wn),En.addChild(xn),en.addChild(gn),an.addChild(gn),hn.addChild(gn),pn.addChild(gn),wn.addChild(gn),xn.addChild(gn);const _n=[];function An(n){if(1===n.type&&n.parents.length>0){const t=n.copy(n.parents[n.parentCount]);_n.push(t)}n.parentCount++,n.children.forEach((t=>{t.parents.push(n),An(t)}))}An(on);let yn=!1,Cn=30;!function(){if(!K)return;const o=40*Math.PI/180;let s=new P(G);s.setViewDistance(350),s.setRotationCenter([0,0,0]),document.getElementById("animCheckbox").onchange=function(){yn=this.checked},document.getElementById("fps").onchange=function(){Cn=Math.min(240,this.valueAsNumber),document.getElementById("fps").valueAsNumber=Cn},document.getElementById("addPlanet").onsubmit=function(n){n.preventDefault();const o=["dxSun","size","orbitRotation","planetRotation"],r={};let a=!0;for(const n of o)r[n]=parseFloat(this.elements[n].value),isNaN(r[n])&&(alert(`You have a problem in: ${n}`),a=!1);a&&function(n){console.log(n),J++;const o=new O("new Orbit "+J),r=new O("new Planet "+J);function a(n,o){return function(e){t(i(e*o),n.localMatrix,n.localMatrix)}}o.localMatrix=e(n.dxSun,0,0),r.localMatrix=u(n.size,n.size,n.size),r.drawInfo={uniforms:{u_colorOffset:[.4,.4,0,1],u_colorMult:[0,.5,.5,1]}},on.addChild(o),o.addChild(r),r.addChild(gn);const c=a(o,n.orbitRotation),s=a(r,n.planetRotation);Q.push(c),Q.push(s),_n.length=0,An(on)}(r)},function(){let e=Date.now();requestAnimationFrame((function u(l){requestAnimationFrame(u);const f=240/Cn,d=1e3/Cn,h=Date.now(),m=h-e;if(m<d)return;e=h-m%d,function(n,t){t=t||1;const o=n.clientWidth*t|0,e=n.clientHeight*t|0;(n.width!==o||n.height!==e)&&(n.width=o,n.height=e)}(K.canvas),K.viewport(0,0,K.canvas.width,K.canvas.height),K.enable(K.CULL_FACE),K.enable(K.DEPTH_TEST),K.clearColor(0,0,0,1),K.clear(K.COLOR_BUFFER_BIT|K.DEPTH_BUFFER_BIT);const p=K.canvas.clientWidth/K.canvas.clientHeight,M=function(t,o,e,r,i){i=i||new n(16);var a=Math.tan(.5*Math.PI-.5*t),c=1/-1999;return i[0]=a/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2001*c,i[11]=-1,i[12]=0,i[13]=0,i[14]=2e3*c*2,i[15]=0,i}(o,p),E=s.getViewMatrix();yn||function(n){const o=.003*n;t(i(o),rn.localMatrix,rn.localMatrix),t(c(un,6*o),an.localMatrix,an.localMatrix),t(c(un,2*o),sn.localMatrix,sn.localMatrix),t(i(6*o),mn.localMatrix,mn.localMatrix),t(c(un,2*o),hn.localMatrix,hn.localMatrix),t(i(2*o),en.localMatrix,en.localMatrix),t(r(o),vn.localMatrix,vn.localMatrix);const e=a(3*o);t(e,Mn.localMatrix,Mn.localMatrix),t(e,En.localMatrix,En.localMatrix),t(e,wn.localMatrix,wn.localMatrix),t(e,xn.localMatrix,xn.localMatrix),Q.forEach((n=>{n(o)}))}(f),on.updateWorldMatrix(),_n.forEach((function(n){n.drawInfo.uniforms.u_P=M,n.drawInfo.uniforms.u_VW=t(E,n.worldMatrix),n.drawInfo.uniforms.u_N=function(n){let t=new Array(9).fill(0),o=n[0],e=n[1],r=n[2],i=n[3],a=n[4],c=n[5],u=n[6],s=n[7],l=n[8],f=n[9],d=n[10],h=n[11],m=n[12],p=n[13],v=n[14],M=n[15],E=o*c-e*a,w=o*u-r*a,x=o*s-i*a,g=e*u-r*c,_=e*s-i*c,A=r*s-i*u,y=l*p-f*m,C=l*v-d*m,b=l*M-h*m,I=f*v-d*p,T=f*M-h*p,L=d*M-h*v,R=E*L-w*T+x*I+g*b-_*C+A*y;return R?(R=1/R,t[0]=(c*L-u*T+s*I)*R,t[1]=(u*b-a*L-s*C)*R,t[2]=(a*T-c*b+s*y)*R,t[3]=(r*T-e*L-i*I)*R,t[4]=(o*L-r*b+i*C)*R,t[5]=(e*b-o*T-i*y)*R,t[6]=(p*A-v*_+M*g)*R,t[7]=(v*x-m*A-M*w)*R,t[8]=(m*_-p*x+M*E)*R,t):null}(n.drawInfo.uniforms.u_VW)}));let w=null,x=null;_n.forEach((function(n){const t=n.drawInfo,o=t.programInfo,e=t.bufferInfo;let r=!1;o!==w&&(w=o,K.useProgram(o.program),r=!0),(r||e!==x)&&(x=e,v(K,o,e)),function(n,...t){n=n.uniformSetters||n;for(const o of t)Object.keys(o).forEach((function(t){const e=n[t];e&&e(o[t])}))}(o,t.uniforms),K.drawArrays(K.TRIANGLES,0,e.numElements)}))}))}()}()})();